<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø²Ù†! | Ø¨Ø§Ø²ÛŒ Ø³Ø±Ø¹Øª Ø¹Ù…Ù„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#020617">

  <style>
    body { background:#020617; }
    .neon-green { box-shadow:0 0 25px #16ff4f,0 0 50px #16ff4f; }
    .neon-red { box-shadow:0 0 25px #ff1645,0 0 50px #ff1645; }
    .neon-yellow { box-shadow:0 0 25px #ffff3f,0 0 50px #ffff3f; color:#000; }
    .neon-btn { box-shadow:0 0 20px #3b82f6,0 0 40px #3b82f6; }
  </style>
</head>
<body class="fixed inset-0 text-white select-none">

<div id="game" class="w-full h-full flex flex-col items-center justify-center text-center transition-all duration-200">

  <!-- ØµÙØ­Ù‡ Ø§ÙˆÙ„: Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø¬Ù‡ Ø³Ø®ØªÛŒ -->
  <div id="difficultyPanel" class="bg-gray-800 bg-opacity-80 p-4 rounded-xl mb-4 max-w-sm">
    <h2 class="text-xl font-bold mb-2">Ø¯Ø±Ø¬Ù‡ Ø³Ø®ØªÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†</h2>
    <div class="grid grid-cols-2 gap-2 mb-2">
      <button class="diff-btn px-3 py-2 bg-green-400 rounded-xl neon-btn" data-diff="Ø¢Ø³Ø§Ù†">Ø¢Ø³Ø§Ù† ğŸ¢</button>
      <button class="diff-btn px-3 py-2 bg-yellow-400 rounded-xl neon-btn" data-diff="Ù†Ø±Ù…Ø§Ù„">Ù†Ø±Ù…Ø§Ù„ ğŸ§ </button>
      <button class="diff-btn px-3 py-2 bg-orange-400 rounded-xl neon-btn" data-diff="Ø³Ø®Øª">Ø³Ø®Øª âš¡</button>
      <button class="diff-btn px-3 py-2 bg-purple-400 rounded-xl neon-btn" data-diff="Ù†ÛŒÙ†Ø¬Ø§">Ù†ÛŒÙ†Ø¬Ø§ ğŸ¥·</button>
    </div>
  </div>

  <!-- ØµÙØ­Ù‡ Ø¯ÙˆÙ…: Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±Ø¹Øª -->
  <div id="speedPanel" class="hidden bg-gray-800 bg-opacity-80 p-4 rounded-xl mb-4 max-w-sm">
    <h2 class="text-xl font-bold mb-2">ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒ Ú†Ù‚Ø¯Ø± Ø³Ø±ÛŒØ¹ÛŒØŸ</h2>
    <div class="grid grid-cols-2 gap-2 mb-2">
      <button class="speed-btn px-3 py-2 bg-yellow-400 rounded-xl neon-btn" data-speed="Ú©Ù†Ø¯ ğŸ¢">Ú©Ù†Ø¯ ğŸ¢</button>
      <button class="speed-btn px-3 py-2 bg-green-400 rounded-xl neon-btn" data-speed="Ù†Ø±Ù…Ø§Ù„ ğŸ§ ">Ù†Ø±Ù…Ø§Ù„ ğŸ§ </button>
      <button class="speed-btn px-3 py-2 bg-blue-400 rounded-xl neon-btn" data-speed="Ø³Ø±ÛŒØ¹ âš¡">Ø³Ø±ÛŒØ¹ âš¡</button>
      <button class="speed-btn px-3 py-2 bg-purple-400 rounded-xl neon-btn" data-speed="Ù†ÛŒÙ†Ø¬Ø§ ğŸ¥·">Ù†ÛŒÙ†Ø¬Ø§ ğŸ¥·</button>
    </div>
    <p class="mb-1">Ø±Ø§Ù‡Ù†Ù…Ø§:</p>
    <ul class="list-disc list-inside text-left mb-2">
      <li>ğŸŸ¢ Ø³Ø¨Ø² â†’ Ø³Ø±ÛŒØ¹ Ø¨Ø²Ù†</li>
      <li>ğŸŸ¡ Ø²Ø±Ø¯ â†’ Ù†Ú¯Ù‡ Ø¯Ø§Ø±</li>
      <li>ğŸ”´ Ù‚Ø±Ù…Ø² â†’ Ù†Ø²Ù†</li>
    </ul>
  </div>

  <!-- Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ø±Ú©ÙˆØ±Ø¯ -->
  <div class="mb-4 text-lg">
    Ø§Ù…ØªÛŒØ§Ø²: <span id="score">0</span>
    <span class="mx-2">|</span>
    Ø±Ú©ÙˆØ±Ø¯: <span id="best">0</span>
  </div>

  <!-- Ù¾Ù†Ù„ Ù†Ù‡Ø§ÛŒÛŒ -->
  <div id="resultPanel" class="hidden fixed inset-0 flex flex-col items-center justify-center bg-black bg-opacity-90 text-center p-4">
    <h2 class="text-3xl font-bold mb-2">Ù†ØªÛŒØ¬Ù‡ Ø¨Ø§Ø²ÛŒ</h2>
    <p class="text-xl mb-1" id="resultScore"></p>
    <p class="text-lg mb-2" id="resultLevel"></p>
    <p class="text-lg mb-4" id="resultMessage"></p>
    <button id="restartBtn" class="px-6 py-2 bg-blue-500 rounded-2xl neon-btn">Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
  </div>

</div>

<!-- ØµØ¯Ø§ -->
<audio id="winSound" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="loseSound" src="https://assets.mixkit.co/active_storage/sfx/2589/2589-preview.mp3"></audio>

<script>
let score = 0;
let color = "red";
let interval = 1200;
let timer;
let holdStart = null;
let userSpeed = null;
let difficulty = null;

const game = document.getElementById("game");
const scoreEl = document.getElementById("score");
const bestEl = document.getElementById("best");

const difficultyPanel = document.getElementById("difficultyPanel");
const speedPanel = document.getElementById("speedPanel");

const resultPanel = document.getElementById("resultPanel");
const resultScore = document.getElementById("resultScore");
const resultLevel = document.getElementById("resultLevel");
const resultMessage = document.getElementById("resultMessage");
const restartBtn = document.getElementById("restartBtn");

const winSound = document.getElementById("winSound");
const loseSound = document.getElementById("loseSound");

let bestScore = localStorage.getItem("bestScore") || 0;
bestEl.textContent = bestScore;

function vibrate(ms=100){ navigator.vibrate?.(ms); }

function levelText(s){
  if(s<5) return "ğŸ¢ Ú©Ù†Ø¯";
  if(s<10) return "ğŸ§  Ù†Ø±Ù…Ø§Ù„";
  if(s<20) return "âš¡ Ø³Ø±ÛŒØ¹";
  return "ğŸ¥· Ù†ÛŒÙ†Ø¬Ø§";
}

// Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø¬Ù‡ Ø³Ø®ØªÛŒ
document.querySelectorAll(".diff-btn").forEach(btn=>{
  btn.onclick=()=>{
    difficulty = btn.dataset.diff;
    difficultyPanel.classList.add("hidden");
    speedPanel.classList.remove("hidden");
  };
});

// Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±Ø¹Øª Ú©Ø§Ø±Ø¨Ø±
document.querySelectorAll(".speed-btn").forEach(btn=>{
  btn.onclick=()=>{
    userSpeed = btn.dataset.speed;
    speedPanel.classList.add("hidden");
    startGame();
  };
});

function startGame(){
  score=0;
  interval = difficulty==="Ø¢Ø³Ø§Ù†"?1200:difficulty==="Ù†Ø±Ù…Ø§Ù„"?1000:difficulty==="Ø³Ø®Øª"?700:500;
  scoreEl.textContent=score;
  resetGameStyle();
  nextRound();
}

function resetGameStyle(){
  game.classList.remove("neon-green","neon-red","neon-yellow");
  if(difficulty==="Ø¢Ø³Ø§Ù†") game.style.background="#001100";
  if(difficulty==="Ù†Ø±Ù…Ø§Ù„") game.style.background="#020617";
  if(difficulty==="Ø³Ø®Øª") game.style.background="#111111";
  if(difficulty==="Ù†ÛŒÙ†Ø¬Ø§") game.style.background="#220022";
}

// Ø¨Ø§Ø²ÛŒ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ
function nextRound(){
  clearTimeout(timer);
  game.classList.remove("neon-green","neon-red","neon-yellow");

  // Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯
  const rand=Math.random();
  if(rand<0.33) color="green";
  else if(rand<0.66) color="yellow";
  else color="red";

  if(color==="green") game.classList.add("neon-green");
  if(color==="yellow") game.classList.add("neon-yellow");
  if(color==="red") game.classList.add("neon-red");

  // Ú†Ø´Ù…Ú© Ø³Ø±ÛŒØ¹
  if(color==="green" && Math.random()<0.3){
    let flash = setTimeout(()=>{
      game.classList.remove("neon-green");
      game.classList.add("neon-red");
      color="red";
    },150);
  }

  holdStart = null;

  timer = setTimeout(()=>{
    if(color==="green") gameOver();
    if(color==="yellow" && holdStart===null) gameOver();
    else nextRound();
  }, interval);

  interval = Math.max(400, interval-30);
}

function gameOver(){
  clearTimeout(timer);
  resetGameStyle();
  vibrate(300);
  loseSound.play();

  if(score>bestScore){
    bestScore=score;
    localStorage.setItem("bestScore", bestScore);
    bestEl.textContent=bestScore;
  }

  let msg="";
  if(userSpeed){
    if(userSpeed.includes("Ú©Ù†Ø¯")){
      msg = score<5 ? "Ú†Ù‚Ø¯Ø± Ú©Ù†Ø¯! ÙÚ©Ø± Ú©Ø±Ø¯ÛŒ Ù†ÛŒÙ†Ø¬Ø§â€ŒØ§ÛŒØŸ ğŸ˜…" : "Ø¯Ø±Ø³Øª Ø­Ø¯Ø³ Ø²Ø¯ÛŒ! Ú©Ù†Ø¯ Ù‡Ù… Ø®ÙˆØ¨Ù‡ ğŸ¢";
    } else if(userSpeed.includes("Ù†Ø±Ù…Ø§Ù„")){
      msg = score<10 ? "ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ø±Ø¯ÛŒ Ù†Ø±Ù…Ø§Ù„ÛŒØŸ Ø­ÛŒÙ Ú©Ù‡ Ø¹Ù‚Ø¨ Ø§ÙØªØ§Ø¯ÛŒ ğŸ˜†" : "Ø®Ø¨ Ø­Ø¯Ø³ Ø²Ø¯ÛŒ! Ø¹Ø§Ù„ÛŒÙ‡ ğŸ§ ";
    } else if(userSpeed.includes("Ø³Ø±ÛŒØ¹")){
      msg = score<20 ? "Ø³Ø±ÛŒØ¹ØŸ Ø¢Ù‡â€¦ Ø®ÛŒÙ„ÛŒ Ú©Ù†Ø¯ Ø¨ÙˆØ¯ÛŒ âš¡ğŸ˜‚" : "ÙˆØ§ÛŒ! Ø¯Ø±Ø³Øª Ø­Ø¯Ø³ Ø²Ø¯ÛŒ! Ø³Ø±ÛŒØ¹ ÙˆØ§Ù‚Ø¹ÛŒ âš¡";
    } else if(userSpeed.includes("Ù†ÛŒÙ†Ø¬Ø§")){
      msg = score<25 ? "Ù†ÛŒÙ†Ø¬Ø§ØŸ Ú©Ù… Ø¢ÙˆØ±Ø¯ÛŒ! ğŸ¥·ğŸ˜‚" : "Ù†ÛŒÙ†Ø¬Ø§ ÙˆØ§Ù‚Ø¹ÛŒ! ğŸ¥·ğŸ”¥";
    }
  }

  resultScore.textContent = `ğŸ’¯ Ø§Ù…ØªÛŒØ§Ø²: ${score}`;
  resultLevel.textContent = `ğŸ§  Ø³Ø·Ø­ ÙˆØ§Ù‚Ø¹ÛŒ: ${levelText(score)}`;
  resultMessage.textContent = msg;
  resultPanel.classList.remove("hidden");
}

// Ø±ÛŒØ³Øª Ø¨Ø§Ø²ÛŒ
restartBtn.onclick = ()=>{
  resultPanel.classList.add("hidden");
  difficultyPanel.classList.remove("hidden");
  userSpeed=null;
  difficulty=null;
  resetGameStyle();
};

// ØªØ¹Ø§Ù…Ù„Ø§Øª Ú©Ø§Ø±Ø¨Ø±
game.addEventListener("mousedown", handleClick);
game.addEventListener("touchstart", handleClick);
game.addEventListener("mouseup", handleRelease);
game.addEventListener("touchend", handleRelease);

function handleClick(e){
  if(difficultyPanel.classList.contains("hidden")===false || speedPanel.classList.contains("hidden")===false) return;

  if(color==="green"){
    score++; scoreEl.textContent=score; winSound.play(); clearTimeout(timer); nextRound();
  } else if(color==="yellow"){
    holdStart = Date.now();
  } else if(color==="red"){
    gameOver();
  }
}

function handleRelease(e){
  if(color==="yellow" && holdStart){
    const holdTime = Date.now()-holdStart;
    if(holdTime<500){ gameOver(); } 
    else { score++; scoreEl.textContent=score; winSound.play(); clearTimeout(timer); nextRound(); }
    holdStart=null;
  }
}

// Service Worker PWA
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
